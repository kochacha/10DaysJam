#include "ScrollManager.h"
#include "Input.h"
#include "LevelSetKeeper.h"

KochaEngine::ScrollManager* KochaEngine::ScrollManager::instance = nullptr;

KochaEngine::ScrollManager::ScrollManager()
	:scrollAmount(0.0f),
	 isBGMChange(false),
	 frameCount(0),
	 time(0),
	 scrollLevel(0)
{
	Initialize();
}

KochaEngine::ScrollManager::~ScrollManager()
{
}

KochaEngine::ScrollManager* KochaEngine::ScrollManager::GetInstance()
{
	if (!instance)
	{
		instance = new ScrollManager();
	}
	return instance;
}

void KochaEngine::ScrollManager::DeleteInstance()
{
	if (instance)
	{
		delete instance;
		instance = nullptr;
	}
}

void KochaEngine::ScrollManager::Initialize()
{
	isBGMChange = false;
	scrollLevel = 1;
	scrollAmount = 0.50f;
	frameCount = 0;
	time = 0;
	ScrollSpeedUp();
}

void KochaEngine::ScrollManager::Update()
{
	LevelSetIndivisual lsi = LevelSetKeeper::GetInstance()->GetCurrentModeWithLevel(scrollLevel);
	//指定秒数経ったら
	if (time >= lsi.secChangeScrollSpeedInterval)
	{
		//レベルを上げる
		scrollLevel += 1;
		isBGMChange = true;
		ScrollSpeedUp();
		time = 0;
	}

	//60フレームで1秒
	frameCount++;
	if (frameCount >= 60)
	{
		time++;
		frameCount = 0;		
	}
}

void KochaEngine::ScrollManager::ScrollSpeedUp()
{
	LevelSetIndivisual lsi = LevelSetKeeper::GetInstance()->GetCurrentModeWithLevel(scrollLevel);
	scrollAmount = lsi.scrollSpeedHundredfold * 0.01f;

	//一応区間ごとに値を調整できるようにしといた
	//switch (scrollLevel)
	//{
	//case 1:
	//	scrollAmount = 0.50f;
	//	//何もなし
	//	break;
	//case 2:
	//	scrollAmount = 0.70f;
	//	//星パチパチ
	//	break;
	//case 3:
	//	scrollAmount = 0.80f;
	//	//星パチパチ強化
	//	break;
	//case 4:
	//	scrollAmount = 1.00f;
	//	//月出現
	//	break;
	//case 5:
	//	scrollAmount = 1.20f;
	//	//流れ星
	//	break;
	//default:
	//	scrollAmount = scrollAmount + 0.1f;
	//	break;
	//}
}

const float KochaEngine::ScrollManager::GetScrollAmount()
{
#ifdef _DEBUG
	static bool isScroll = true;
	if (Input::TriggerKey(DIK_LCONTROL))
	{
		isScroll = !isScroll;
	}

	if (isScroll)
	{
		return scrollAmount;
	}
	else
	{
		return 0;
	}
#endif // _DEBUG

	return scrollAmount;
}

const int KochaEngine::ScrollManager::GetScrollLevel()
{
	return scrollLevel;
}

void KochaEngine::ScrollManager::AddScrollLevel(const int arg_add)
{
	scrollLevel += arg_add;
}
